<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Calculator - Quantum Converter</title>

    <style>
        /* =================================================== */
        /* == 0. STYLE DE L'HORLOGE EN DIRECT (CSS)           == */
        /* =================================================== */
        .live-clock {
            font-family: 'Orbitron', monospace; 
            font-size: 1em; 
            color: var(--color-secondary);
            text-align: center;
            margin-bottom: 5px;
            padding: 2px 0;
            border-bottom: 1px dashed rgba(255, 0, 255, 0.3);
            text-shadow: 0 0 10px var(--color-secondary);
        }
        
        /* =================================================== */
        /* == 1. STYLES GLOBALES & FOND QUANTIQUE (CSS)       == */
        /* =================================================== */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');
        
        :root {
            --color-bg: #100b1a;
            --color-primary: #00eaff;
            --color-secondary: #ff00ff;
            --color-text: #b3ecff;
            --color-error: #ff4757;
            --color-accent: #005663;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--color-bg) 0%, #1a0f28 100%);
            color: var(--color-text);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        /* Conteneur principal */
        .converter-container {
            background-color: rgba(16, 11, 26, 0.95);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 0 50px var(--color-primary), inset 0 0 15px var(--color-accent);
            width: 95vw;
            max-width: 1200px;
            height: 95vh;
            max-height: 900px;
            border: 2px solid var(--color-primary);
            position: relative;
            animation: pulse-border 5s infinite alternate ease-in-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @keyframes pulse-border {
            0% { border-color: var(--color-primary); box-shadow: 0 0 30px var(--color-primary); }
            100% { border-color: var(--color-secondary); box-shadow: 0 0 40px var(--color-secondary); }
        }

        h1 {
            color: var(--color-primary);
            text-align: center;
            font-size: 1.8em;
            margin: 0 0 2px 0;
            text-shadow: 0 0 8px var(--color-primary);
        }

        .subtitle {
            text-align: center;
            color: var(--color-secondary);
            margin: 0 0 10px 0;
            font-size: 0.75em;
            letter-spacing: 1.5px;
        }
        
        /* =================================================== */
        /* == 2. GESTION DES VUES (Onglets) (CSS)           == */
        /* =================================================== */
        
        .view {
            transition: opacity 0.3s ease-in-out;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .view.hidden {
            display: none;
            opacity: 0;
            pointer-events: none;
        }
        
        .tab-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 12px;
            padding: 6px 0;
            border-bottom: 1px solid var(--color-accent);
        }
        
        .tab-button {
            background: none;
            border: none;
            color: var(--color-text);
            font-size: 1.1em;
            cursor: pointer;
            padding: 4px 10px;
            transition: color 0.2s;
            display: flex;
            align-items: center;
        }

        .tab-button.active, .tab-button:hover {
            color: var(--color-primary);
            text-shadow: 0 0 5px var(--color-primary);
        }
        
        .ruler-icon {
            font-size: 1.2em; 
            margin-right: 5px;
        }
        
        /* =================================================== */
        /* == 3. STYLES CALCULATRICE & CONVERTISSEUR (CSS)  == */
        /* =================================================== */
        
        .input-group {
             margin-bottom: 8px;
        }

        label {
            font-weight: bold;
            margin-bottom: 3px;
            color: var(--color-secondary);
            text-shadow: 0 0 2px var(--color-secondary);
            font-size: 0.8em;
            display: block;
        }

        input[type="text"], select {
            padding: 10px 12px;
            border: 1px solid var(--color-primary);
            border-radius: 8px;
            font-size: 1.1em;
            background-color: var(--color-accent);
            color: var(--color-primary);
            text-align: right;
            box-shadow: inset 0 0 10px var(--color-accent);
            transition: all 0.3s;
            width: 100%; 
        }

        .calculator-view #calcDisplay {
            font-size: 1.4em;
        }

        .calculator-view #calcResultDisplay {
            background-color: rgba(0, 150, 200, 0.1);
            border-color: var(--color-secondary);
            color: var(--color-secondary);
            font-size: 1.3em;
            margin-bottom: 10px;
        }
        
        .converter-view .conversion-block {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
            overflow-y: auto;
        }
        
        .converter-view #currentValueDisplay {
            color: var(--color-secondary); 
            border-color: var(--color-secondary);
            font-size: 1.4em;
        }

        .units-group {
            display: flex;
            align-items: flex-end;
            gap: 10px;
        }

        .unit-select {
            flex-grow: 1;
        }
        
        .swap-button {
            cursor: pointer;
            font-size: 26px;
            align-self: center;
            margin: 0 4px 4px 4px;
            color: var(--color-primary);
            transition: transform 0.2s, color 0.2s;
            text-shadow: 0 0 5px var(--color-primary);
        }

        .swap-button:hover {
            transform: rotate(180deg);
            color: var(--color-secondary);
        }

        .result-group {
            margin-top: 12px;
            padding: 12px;
            background-color: rgba(0, 70, 80, 0.4);
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
            box-shadow: 0 0 15px var(--color-accent);
        }

        .result-group p {
            text-align: left;
            margin: 0;
            color: var(--color-text);
            font-size: 0.85em;
        }
        
        .result {
            font-size: 2em;
            font-weight: 700;
            color: var(--color-primary) !important;
            margin-top: 4px !important;
            word-break: break-all;
            text-shadow: 0 0 10px var(--color-primary);
        }
        
        .history-container {
            margin-top: 12px;
            padding: 10px;
            border-top: 1px dashed var(--color-accent);
            max-height: 180px;
            overflow-y: auto;
        }

        .history-container h3 {
            font-size: 0.9em;
            margin: 0 0 6px 0;
            color: var(--color-secondary);
        }

        .history-container ul {
            list-style: none;
            padding: 0;
            margin: 0 0 6px 0;
        }

        .history-container li {
            font-size: 0.75em;
            padding: 5px;
            margin-bottom: 3px;
            background-color: rgba(0, 234, 255, 0.1);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .history-container li:hover {
            background-color: rgba(0, 234, 255, 0.2);
        }
        
        /* =================================================== */
        /* == 4. STYLES DE LA CALCULATRICE GRID (CSS)       == */
        /* =================================================== */

        .calculator-grid {
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            flex: 1;
        }

        .calc-button {
            background-color: var(--color-accent);
            border: none;
            padding: 0;
            border-radius: 12px;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            color: var(--color-text);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.15s;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            min-height: 65px;
        }
        
        .calc-button:hover {
            background-color: var(--color-primary);
            color: var(--color-bg);
            box-shadow: 0 0 25px var(--color-primary);
            transform: scale(1.05);
        }

        .calc-button:active {
            transform: scale(0.95);
        }

        .calc-button.color-red { background-color: #5c0000; color: var(--color-error); }
        .calc-button.color-green { background-color: #005609; color: #76ff03; }
        .calc-button.color-light-green { background-color: #2a382d; color: #80ffa2; }
        .calc-button.operator { background-color: #1a0f28; color: var(--color-secondary); border: 1px solid var(--color-secondary); }
        
        .calc-button[data-action="equals"] {
            background: linear-gradient(45deg, var(--color-secondary), var(--color-primary));
            color: var(--color-bg);
            font-size: 1.6em;
            box-shadow: 0 0 20px var(--color-primary);
        }
        
        /* =================================================== */
        /* == 5. STYLES DES BLOCS PUBLICITAIRES (CSS)       == */
        /* =================================================== */

        .ad-container {
            text-align: center;
            margin: 8px 0;
            padding: 6px;
            border: 1px dashed var(--color-error); 
            background-color: rgba(255, 71, 87, 0.1); 
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.4);
            min-height: 40px; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ad-container p {
            color: var(--color-error);
            font-size: 0.7em;
            margin: 0;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .ad-container.bottom-ad {
            margin-top: 12px; 
            min-height: 85px;
        }
        
        /* =================================================== */
        /* == 6. OPTIMISATION MOBILE & TABLETTE             == */
        /* =================================================== */

        /* Tablettes en paysage et petits desktops */
        @media (max-width: 1024px) and (min-width: 769px) {
            .converter-container {
                max-width: 900px;
            }

            .calc-button {
                font-size: 1.25em;
                min-height: 60px;
            }
        }

        /* Tablettes en portrait */
        @media (max-width: 768px) and (min-width: 481px) {
            .converter-container {
                width: 95vw;
                max-width: 650px;
                padding: 12px 18px;
            }

            h1 {
                font-size: 1.6em;
            }

            .calc-button {
                font-size: 1.2em;
                min-height: 58px;
            }
        }

        /* Smartphones */
        @media (max-width: 480px) {
            .converter-container {
                width: 100vw;
                height: 100vh;
                border-radius: 0;
                padding: 10px 15px;
                max-height: 100vh;
            }

            .live-clock {
                font-size: 0.9em;
                margin-bottom: 3px;
            }

            h1 {
                font-size: 1.4em;
                margin-bottom: 1px;
            }

            .subtitle {
                font-size: 0.65em;
                margin-bottom: 6px;
            }

            .tab-bar {
                gap: 15px;
                margin-bottom: 8px;
                padding: 4px 0;
            }

            .tab-button {
                font-size: 0.95em;
                padding: 3px 8px;
            }

            .input-group {
                margin-bottom: 6px;
            }

            label {
                font-size: 0.7em;
                margin-bottom: 2px;
            }

            input[type="text"], select {
                padding: 7px 8px;
                font-size: 1em;
            }

            .calculator-view #calcDisplay {
                font-size: 1.2em;
            }

            .calculator-view #calcResultDisplay {
                font-size: 1.1em;
                margin-bottom: 8px;
            }

            .calculator-grid {
                gap: 7px;
                margin-top: 8px;
            }
            
            .calc-button {
                font-size: 1.1em;
                min-height: 52px;
            }

            .calc-button[data-action="equals"] {
                font-size: 1.3em;
            }
            
            .result {
                font-size: 1.7em;
            }

            .ad-container {
                min-height: 35px;
                padding: 5px;
                margin: 6px 0;
            }

            .ad-container p {
                font-size: 0.6em;
            }

            .ad-container.bottom-ad {
                min-height: 70px;
                margin-top: 10px;
            }
        }

        @media (max-width: 480px) and (max-height: 750px) {
            .converter-container {
                padding: 8px 12px;
            }

            .live-clock {
                font-size: 0.85em;
                margin-bottom: 2px;
            }

            h1 {
                font-size: 1.3em;
            }

            .subtitle {
                font-size: 0.6em;
                margin-bottom: 5px;
            }

            .tab-bar {
                margin-bottom: 6px;
            }

            .calc-button {
                min-height: 48px;
                font-size: 1.05em;
            }

            .ad-container {
                min-height: 30px;
            }

            .ad-container.bottom-ad {
                min-height: 60px;
            }
        }

        @media (max-width: 480px) and (max-height: 680px) {
            .live-clock {
                font-size: 0.8em;
            }

            h1 {
                font-size: 1.2em;
            }

            .subtitle {
                font-size: 0.55em;
            }

            .calc-button {
                min-height: 45px;
                font-size: 1em;
            }

            .calculator-grid {
                gap: 6px;
            }
        }

        /* Desktop - hauteurs limit√©es */
        @media (min-width: 769px) and (max-height: 800px) {
            .converter-container {
                padding: 12px 20px;
            }

            h1 {
                font-size: 1.6em;
            }

            .calc-button {
                min-height: 58px;
                font-size: 1.2em;
            }
        }

        /* Scrollbar personnalis√©e */
        .history-container::-webkit-scrollbar,
        .conversion-block::-webkit-scrollbar {
            width: 6px;
        }

        .history-container::-webkit-scrollbar-track,
        .conversion-block::-webkit-scrollbar-track {
            background: rgba(0, 86, 99, 0.3);
            border-radius: 3px;
        }

        .history-container::-webkit-scrollbar-thumb,
        .conversion-block::-webkit-scrollbar-thumb {
            background: var(--color-primary);
            border-radius: 3px;
        }

        .history-container::-webkit-scrollbar-thumb:hover,
        .conversion-block::-webkit-scrollbar-thumb:hover {
            background: var(--color-secondary);
        }
    </style>
</head>
<body>
    <div class="converter-container">
        
        <div id="liveClock" class="live-clock">--:--:--</div>
        
        <h1>Nexus Calculator</h1>
        <p class="subtitle">Matrice de conversion unifi√©e et calcul √©valuatif</p>

        <div class="ad-container top-ad">
            <p>‚≠ê Banni√®re Publicitaire - 320x50/320x100 (Espace Publicitaire)</p>
        </div>
        
        <div class="tab-bar">
            <button class="tab-button active" onclick="showView('calculator')">
                <span class="ruler-icon">‚ûó</span> Calculatrice
            </button>
            <button class="tab-button" onclick="showView('converter')">
                <span class="ruler-icon">üìê</span> Convertisseur
            </button>
        </div>
        
        <div id="calculatorView" class="view calculator-view">
            
            <div class="input-group">
                <label for="calcDisplay">EXPRESSION DE BASE :</label>
                <input type="text" id="calcDisplay" value="0" readonly>
            </div>

            <div class="input-group">
                <label for="calcResultDisplay">R√âSULTAT DU CALCUL :</label>
                <input type="text" id="calcResultDisplay" value="0" readonly>
            </div>
            
            <input type="hidden" id="inputValue" value="0"> 
            
            <div class="calculator-grid">
                <button class="calc-button color-red" data-action="clear" data-display="C" style="font-size: 1.5em;">C</button>
                <button class="calc-button color-light-green" data-value="(" data-display="(">(</button>
                <button class="calc-button color-light-green" data-value=")" data-display=")">)</button>
                <button class="calc-button operator" data-value="%" data-display="%">%</button>

                <button class="calc-button operator" data-value="/" data-display="√∑">√∑</button>
                <button class="calc-button number-button" data-value="7" data-display="7">7</button>
                <button class="calc-button number-button" data-value="8" data-display="8">8</button>
                <button class="calc-button number-button" data-value="9" data-display="9">9</button>

                <button class="calc-button operator" data-value="*" data-display="√ó">√ó</button>
                <button class="calc-button number-button" data-value="4" data-display="4">4</button>
                <button class="calc-button number-button" data-value="5" data-display="5">5</button>
                <button class="calc-button number-button" data-value="6" data-display="6">6</button>

                <button class="calc-button operator" data-value="-" data-display="-">-</button>
                <button class="calc-button number-button" data-value="1" data-display="1">1</button>
                <button class="calc-button number-button" data-value="2" data-display="2">2</button>
                <button class="calc-button number-button" data-value="3" data-display="3">3</button>
                
                <button class="calc-button operator" data-value="+" data-display="+">+</button>
                <button class="calc-button" data-action="plus-minus" data-display="+/-">+/-</button>
                <button class="calc-button number-button" data-value="0" data-display="0">0</button>
                <button class="calc-button number-button" data-value="." data-display=",">,</button>
            </div>
            
            <div class="calculator-grid" style="grid-template-columns: 1fr 3fr; margin-top: 10px;">
                <button class="calc-button color-red" data-action="backspace" data-display="‚å´" style="font-size: 1.5em;" title="Effacer le dernier caract√®re">‚å´</button>
                <button class="calc-button color-green" data-action="equals" data-display="=" style="font-size: 1.6em;">=</button>
            </div>
            
        </div>

        <div id="converterView" class="view converter-view hidden">
            <div class="conversion-block">
                <div class="input-group">
                    <label for="category">CAT√âGORIE / Matrice :</label>
                    <select id="category">
                        <option value="area">Aire</option>
                        <option value="length">Longueur</option>
                        <option value="temperature">Temp√©rature</option>
                        <option value="volume">Volume</option>
                        <option value="mass">Masse</option>
                        <option value="data">Donn√©es</option>
                        <option value="speed">Vitesse</option>
                        <option value="time">Temps</option>
                        <option value="quantum">√ânergie Quantique (Exotique)</option>
                        <option value="currency">Monnaie Virtuelle (Hypoth√©tique)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="currentValueDisplay">VALEUR √Ä CONVERTIR (du Calcul) :</label>
                    <input type="text" id="currentValueDisplay" value="0" readonly>
                </div>

                <div class="units-group">
                    <div class="unit-select">
                        <label for="fromUnit">SOURCE (De) :</label>
                        <select id="fromUnit"></select>
                    </div>
                    <span class="swap-button" id="swapUnits">‚Üî</span>
                    <div class="unit-select">
                        <label for="toUnit">CIBLE (Vers) :</label>
                        <select id="toUnit"></select>
                    </div>
                </div>

                <div class="result-group">
                    <p>R√âSULTAT CONVERTI :</p>
                    <p class="result" id="resultValue">---</p>
                </div>
                
                <div class="ad-container bottom-ad">
                    <p>Annonce Bloc - 300x250 (Espace Publicitaire)</p>
                </div>

                <div class="history-container">
                    <h3>Historique des Conversions R√©cents</h3>
                    <ul id="historyList"></ul>
                    <button class="calc-button operator" data-action="clear-history" style="width: 100%; font-size: 0.8em; padding: 10px 0;" title="Effacer l'historique">Effacer l'Historique</button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // JAVASCRIPT: Logiciel du Quantum-Converter
        
        // --- 1. Constantes de Conversion ---
        const units = {
            area: {
                'm¬≤': { name: 'M√®tres carr√©s', toBase: 1 }, 'cm¬≤': { name: 'Centim√®tres carr√©s', toBase: 0.0001 },
                'ft¬≤': { name: 'Pieds carr√©s', toBase: 0.092903 }, 'in¬≤': { name: 'Pouces carr√©s', toBase: 0.00064516 },
                'a': { name: 'Ares', toBase: 100 }, 'ha': { name: 'Hectares', toBase: 10000 },
                'ac': { name: 'Acres', toBase: 4046.86 },
            },
            length: {
                'm': { name: 'M√®tres', toBase: 1 }, 'mm': { name: 'Millim√®tres', toBase: 0.001 },
                'cm': { name: 'Centim√®tres', toBase: 0.01 }, 'km': { name: 'Kilom√®tres', toBase: 1000 },
                'in': { name: 'Pouces', toBase: 0.0254 }, 'ft': { name: 'Pieds', toBase: 0.3048 },
                'yd': { name: 'Yards', toBase: 0.9144 }, 'mi': { name: 'Miles', toBase: 1609.34 },
                'NM': { name: 'Milles nautiques', toBase: 1852 }, 'mil': { name: 'Mils', toBase: 0.0000254 },
            },
            temperature: {
                'C': { name: 'Celsius', toBase: null }, 'F': { name: 'Fahrenheit', toBase: null },
                'K': { name: 'Kelvin', toBase: null },
            },
            volume: {
                'l': { name: 'Litres', toBase: 1 }, 'ml': { name: 'Millilitres', toBase: 0.001 },
                'cc': { name: 'Centim√®tres cubes', toBase: 0.001 }, 'm¬≥': { name: 'M√®tres cubes', toBase: 1000 },
                'gal_us': { name: 'Gallons US', toBase: 3.78541 }, 'gal_uk': { name: 'Gallons UK', toBase: 4.54609 },
                'in¬≥': { name: 'Pouces cubes', toBase: 0.0163871 }, 'ft¬≥': { name: 'Pieds cubes', toBase: 28.3168 },
            },
            mass: {
                'kg': { name: 'Kilogrammes', toBase: 1 }, 'g': { name: 'Grammes', toBase: 0.001 },
                'oz': { name: 'Onces', toBase: 0.0283495 }, 'lb': { name: 'Livres', toBase: 0.453592 },
                't': { name: 'Tonnes m√©triques', toBase: 1000 }, 't_uk': { name: 'Tonnes UK', toBase: 1016.05 },
                't_us': { name: 'Tonnes US', toBase: 907.185 },
            },
            data: {
                'o': { name: 'Octets', toBase: 1 }, 'bit': { name: 'Bits', toBase: 0.125 }, 
                'Ko': { name: 'Kilo-octets (1000)', toBase: 1000 }, 'Mo': { name: 'M√©ga-octets (1000¬≤)', toBase: 1000000 },
                'Go': { name: 'Giga-octets (1000¬≥)', toBase: 1000000000 }, 'KiB': { name: 'Kibioctets (1024)', toBase: 1024 },
                'MiB': { name: 'Mebioctets (1024¬≤)', toBase: 1048576 }, 'GiB': { name: 'Gibioctets (1024¬≥)', toBase: 1073741824 },
                'To': { name: 'T√©ra-octets (1000‚Å¥)', toBase: 1000000000000 }, 'TiB': { name: 'T√©bioctets (1024‚Å¥)', toBase: 1099511627776 },
            },
            speed: {
                'm/s': { name: 'M√®tres par seconde', toBase: 1 }, 'km/h': { name: 'Kilom√®tres par heure', toBase: 1 / 3.6 },
                'km/s': { name: 'Kilom√®tres par seconde', toBase: 1000 }, 'm/h': { name: 'M√®tres par heure', toBase: 1 / 3600 },
                'in/s': { name: 'Pouces par seconde', toBase: 0.0254 }, 'in/h': { name: 'Pouces par heure', toBase: 0.00000705556 },
                'ft/s': { name: 'Pieds par seconde', toBase: 0.3048 }, 'ft/h': { name: 'Pieds par heure', toBase: 0.0000846667 },
                'mi/h': { name: 'Miles par heure', toBase: 0.44704 }, 'mi/s': { name: 'Miles par seconde', toBase: 1609.34 },
                'kn': { name: 'N≈ìuds', toBase: 0.514444 },
            },
            time: {
                's': { name: 'Secondes', toBase: 1 }, 'ms': { name: 'Millisecondes', toBase: 0.001 },
                'min': { name: 'Minutes', toBase: 60 }, 'h': { name: 'Heures', toBase: 3600 },
                'd': { name: 'Jours', toBase: 86400 }, 'wk': { name: 'Semaines', toBase: 604800 },
            },
            quantum: {
                'J': { name: 'Joules', toBase: 1 }, 'eV': { name: '√âlectron-Volts', toBase: 1.602176634e-19 },
                'Qbits': { name: 'Qubits d\'√©nergie', toBase: 6.62607015e-34 * 1e15 }, 
                'Planck': { name: 'Unit√©s de Planck', toBase: 1.9561e9 }, 
            },
            currency: {
                'BTC': { name: 'Bitcoin', toBase: 1 }, 'ETH': { name: 'Ethereum', toBase: 0.05 }, 
                'ADA': { name: 'Cardano', toBase: 0.00005 }, 'SOL': { name: 'Solana', toBase: 0.005 },
            }
        };

        // --- 2. Fonctions de Conversion Sp√©ciales ---

        function convertTemperature(value, fromUnit, toUnit) {
            let kelvinValue;
            
            if (fromUnit === 'C') {
                kelvinValue = value + 273.15;
            } else if (fromUnit === 'F') {
                kelvinValue = (value - 32) * (5 / 9) + 273.15;
            } else if (fromUnit === 'K') {
                kelvinValue = value;
            } else {
                return 0;
            }

            if (toUnit === 'C') {
                return kelvinValue - 273.15;
            } else if (toUnit === 'F') {
                return (kelvinValue - 273.15) * (9 / 5) + 32;
            } else if (toUnit === 'K') {
                return kelvinValue;
            }
            return 0;
        }

        // --- 3. Logique DOM et Gestionnaire d'√âv√©nements ---

        const calculatorView = document.getElementById('calculatorView');
        const converterView = document.getElementById('converterView');
        const tabButtons = document.querySelectorAll('.tab-button');
        
        const categorySelect = document.getElementById('category');
        const fromUnitSelect = document.getElementById('fromUnit');
        const toUnitSelect = document.getElementById('toUnit');
        const inputValue = document.getElementById('inputValue'); 
        const calcDisplay = document.getElementById('calcDisplay'); 
        const calcResultDisplay = document.getElementById('calcResultDisplay'); 
        const currentValueDisplay = document.getElementById('currentValueDisplay'); 
        const resultValue = document.getElementById('resultValue'); 
        const swapButton = document.getElementById('swapUnits');
        const calculatorGrid = document.querySelector('.calculator-grid');
        const historyList = document.getElementById('historyList');

        let isResult = false; 
        let history = JSON.parse(localStorage.getItem('quantumConverterHistory')) || [];

        // Fonction pour changer de vue (onglet)
        function showView(viewName) {
            calculatorView.classList.add('hidden');
            converterView.classList.add('hidden');
            
            tabButtons.forEach(btn => btn.classList.remove('active'));

            if (viewName === 'calculator') {
                calculatorView.classList.remove('hidden');
                tabButtons[0].classList.add('active'); 
            } else if (viewName === 'converter') {
                converterView.classList.remove('hidden');
                tabButtons[1].classList.add('active'); 
                
                // Mettre √† jour la valeur affich√©e pour la conversion
                const currentValue = parseFloat(inputValue.value);
                const formattedValue = (isNaN(currentValue) || inputValue.value === 'Erreur') ? '0' : 
                    ((Math.abs(currentValue) > 1e6 || Math.abs(currentValue) < 1e-6)
                    ? currentValue.toExponential(4).replace(/\./, ',')
                    : currentValue.toPrecision(8).replace(/\.0+$/, '').replace(/\./, ','));
                    
                currentValueDisplay.value = formattedValue;
                convert(); 
            }
        }
        
        function updateUnitSelects() {
            const selectedCategory = categorySelect.value;
            const currentUnits = units[selectedCategory];

            const currentFrom = fromUnitSelect.value;
            const currentTo = toUnitSelect.value;

            fromUnitSelect.innerHTML = '';
            toUnitSelect.innerHTML = '';

            for (const key in currentUnits) {
                const name = currentUnits[key].name;
                const option = new Option(`${name} (${key})`, key);
                fromUnitSelect.add(option.cloneNode(true));
                toUnitSelect.add(option);
            }

            const unitKeys = Object.keys(currentUnits);
            fromUnitSelect.value = unitKeys.includes(currentFrom) ? currentFrom : unitKeys[0];
            toUnitSelect.value = unitKeys.includes(currentTo) ? currentTo : unitKeys[1] || unitKeys[0];

            convert();
        }
        
        function swapUnits() {
            const from = fromUnitSelect.value;
            fromUnitSelect.value = toUnitSelect.value;
            toUnitSelect.value = from;
            convert();
        }
        
        function evaluateExpression(expression) {
            let cleanExpression = expression
                .replace(/,/g, '.')  
                .replace(/√ó/g, '*')
                .replace(/√∑/g, '/');
            
            cleanExpression = cleanExpression.replace(/(\d+(\.\d+)?)%/g, '($1/100)');

            try {
                const result = new Function('return ' + cleanExpression)();
                if (!isFinite(result)) return 'Erreur';
                return parseFloat(result.toFixed(10));
            } catch (e) {
                return 'Erreur';
            }
        }

        function convert() {
            const value = parseFloat(inputValue.value);
            const selectedCategory = categorySelect.value;
            const fromUnit = fromUnitSelect.value;
            const toUnit = toUnitSelect.value;

            if (isNaN(value) || inputValue.value === 'Erreur' || !units[selectedCategory] || !units[selectedCategory][fromUnit] || !units[selectedCategory][toUnit]) {
                resultValue.textContent = '--- ERREUR ---';
                return;
            }
            
            if (fromUnit === toUnit) {
                resultValue.textContent = `${value.toPrecision(8).replace(/\.0+$/, '').replace(/\./, ',')} ${fromUnit}`;
                return;
            }

            let convertedValue;

            if (selectedCategory === 'temperature') {
                convertedValue = convertTemperature(value, fromUnit, toUnit);
            } else {
                const unitData = units[selectedCategory];
                
                const valueInBase = value * unitData[fromUnit].toBase;
                convertedValue = valueInBase / unitData[toUnit].toBase;
            }

            const formattedResult = (Math.abs(convertedValue) > 1e6 || Math.abs(convertedValue) < 1e-6)
                ? convertedValue.toExponential(4).replace(/\./, ',')
                : convertedValue.toPrecision(8).replace(/\.0+$/, '').replace(/\./, ',');
            
            resultValue.textContent = `${formattedResult} ${toUnit}`;
        }
        
        function updateHistory(fromValue, fromUnit, toValue, toUnit, category) {
            const entry = {
                expression: calcDisplay.value,
                from: `${fromValue.toPrecision(4).replace(/\./, ',')} ${fromUnit}`,
                to: `${toValue} ${toUnit}`,
                category: category
            };
            
            history.unshift(entry);
            history = history.slice(0, 5); 
            
            localStorage.setItem('quantumConverterHistory', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            historyList.innerHTML = '';
            history.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `[${item.category}] <b>${item.expression}</b> = ${item.to}`;
                li.onclick = () => {
                    const calculatedValue = evaluateExpression(item.expression);
                    
                    calcDisplay.value = item.expression;
                    calcResultDisplay.value = calculatedValue.toString().replace('.', ',');
                    inputValue.value = calculatedValue;
                    
                    document.getElementById('category').value = item.category;
                    updateUnitSelects(); 
                    showView('converter');
                };
                historyList.appendChild(li);
            });
            if (history.length === 0) {
                historyList.innerHTML = '<li>Historique vide.</li>';
            }
        }
        
        function clearHistory() {
            history = [];
            localStorage.removeItem('quantumConverterHistory');
            renderHistory();
        }


        // --- 4. Logique de la Calculatrice ---

        calculatorGrid.addEventListener('click', (e) => {
            if (!e.target.classList.contains('calc-button')) return;

            const button = e.target;
            const displayValue = button.getAttribute('data-display') || button.textContent;
            const internalValue = button.getAttribute('data-value');
            const action = button.getAttribute('data-action');
            let currentDisplay = calcDisplay.value;
            const operators = ['+', '-', '*', '/', '%', '(', ')'];
            
            if (isResult && action !== 'equals') {
                if (internalValue && operators.includes(internalValue)) {
                    currentDisplay = evaluateExpression(currentDisplay).toString().replace('.', ','); 
                } else {
                    currentDisplay = '0'; 
                }
                isResult = false;
                calcResultDisplay.value = '0';
            }

            // --- GESTION DES ACTIONS SP√âCIALES ---
            if (action === 'clear') {
                calcDisplay.value = '0';
                inputValue.value = '0';
                calcResultDisplay.value = '0';
                isResult = false;
            } else if (action === 'backspace') {
                if (currentDisplay.length > 1) {
                    calcDisplay.value = currentDisplay.slice(0, -1);
                } else {
                    calcDisplay.value = '0';
                }
                isResult = false; 
                calcResultDisplay.value = '0';
            } else if (action === 'equals') {
                const result = evaluateExpression(currentDisplay);
                
                if (result === 'Erreur') {
                    calcResultDisplay.value = 'Erreur';
                    inputValue.value = 'Erreur';
                } else {
                    
                    const formattedCalcResult = String(result).replace('.', ',');
                    calcResultDisplay.value = formattedCalcResult; 
                    inputValue.value = result; 
                    
                    if (result !== 0) {
                        const fromUnit = fromUnitSelect.value;
                        const toUnit = toUnitSelect.value;
                        const category = categorySelect.value;
                        updateHistory(result, fromUnit, resultValue.textContent, toUnit, category);

                        showView('converter'); 
                        return; 
                    }
                }
                isResult = true;
                
            } else if (action === 'plus-minus') {
                if (!currentDisplay.match(/[+\-\*\/\%\(\)√ó√∑]/)) {
                    calcDisplay.value = currentDisplay.startsWith('-') ? currentDisplay.substring(1) : '-' + currentDisplay;
                }
            } else {
            // --- GESTION DE LA SAISIE STANDARD ---

                if (currentDisplay === '0' && internalValue && !internalValue.match(/[\+\-\*\/\%\(\)]/)) {
                    if (internalValue === '.') {
                        currentDisplay = '0,';
                    } else {
                        currentDisplay = displayValue;
                    }
                } else {
                    const lastChar = currentDisplay.slice(-1);
                    const isLastCharOp = operators.includes(lastChar) || lastChar.match(/[√ó√∑%]/);
                    const isNewCharOp = internalValue && operators.includes(internalValue) || displayValue.match(/[√ó√∑%]/);
                    
                    if (displayValue === ',') {
                        const currentNumber = currentDisplay.split(/[\+\-\*\/\%\(\)√ó√∑]/).pop();
                        if (currentNumber.includes(',') || isLastCharOp) {
                            return; 
                        }
                    } else if (isNewCharOp && isLastCharOp) {
                        currentDisplay = currentDisplay.slice(0, -1) + displayValue;
                    } else {
                        currentDisplay += displayValue;
                    }
                }
                
                calcDisplay.value = currentDisplay;

                const tempResult = evaluateExpression(currentDisplay);
                inputValue.value = (tempResult !== 'Erreur' && tempResult !== '') ? tempResult : 0;
                
                calcResultDisplay.value = (tempResult !== 'Erreur') ? String(tempResult).replace('.', ',') : '0';
            }
        });

        // √âv√©nement pour le bouton clear-history
        document.querySelector('[data-action="clear-history"]').addEventListener('click', clearHistory);

        // --- 5. Logique de l'Horloge en Temps R√©el ---

        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            document.getElementById('liveClock').textContent = `${hours}:${minutes}:${seconds}`;
        }


        // √âv√©nements du convertisseur
        categorySelect.addEventListener('change', updateUnitSelects);
        fromUnitSelect.addEventListener('change', convert);
        toUnitSelect.addEventListener('change', convert);
        swapButton.addEventListener('click', swapUnits);
        
        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
             calcDisplay.value = '0'; 
             inputValue.value = '0';
             calcResultDisplay.value = '0';
             renderHistory();
             updateUnitSelects();
             showView('calculator'); // Afficher la calculatrice par d√©faut
             
             // D√©marrer l'horloge
             updateClock(); // Appeler une premi√®re fois imm√©diatement
             setInterval(updateClock, 1000); // Mettre √† jour toutes les 1000 millisecondes (1 seconde)
        });
    </script>
</body>
</html>
